:root{
  --bg-1: #fff0f6;
  --bg-2: #ffeef3;
  --accent: #ff6f98;
  --accent-dark: #d04466;
  --envelope-1: #ffd2e6;
  --envelope-2: #ff9fcf;
  --envelope-border: rgba(208,49,99,0.18);
  --paper: #fff9f4; /* warmer off-white so the letter stands out */
  --shadow: rgba(9,9,21,0.22);
  --muted: #9a5a6e;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  background: radial-gradient(1200px 600px at 10% 10%, #fff6fb 0%, transparent 20%),
              radial-gradient(1000px 500px at 90% 90%, #fff9f9 0%, transparent 18%),
              linear-gradient(180deg,#ffeef3 0%, #fff0f6 100%);
  color:#3b1b2b;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
}
.page{width:100%;max-width:980px}
.hero{text-align:center;margin-bottom:18px}
.hero h1{font-size:2.2rem;margin:0 0 6px;color:var(--accent-dark);letter-spacing:0.6px}
.subtitle{margin:0;color:var(--muted)}
.stage{display:flex;flex-direction:column;align-items:center;gap:18px}
.env-area{perspective:1100px}
.envelope{width:480px;max-width:94vw;height:320px;position:relative;transform-style:preserve-3d;cursor:pointer;user-select:none;will-change:transform}
.envelope *{transition:transform 700ms cubic-bezier(.22,.9,.38,1), box-shadow 300ms}
.envelope-body{
  position:relative;
  width:100%;
  height:100%;
  background: linear-gradient(180deg, var(--envelope-1) 0%, var(--envelope-2) 100%);
  border-radius:18px;
  box-shadow: 0 30px 60px var(--shadow), inset 0 -6px 18px rgba(255,255,255,0.06);
  overflow:hidden;
  border: 3px solid var(--envelope-border);
  transform: translateZ(12px);
}
.envelope-front{position:absolute;inset:0;display:flex;align-items:flex-end;justify-content:center;padding-bottom:18px}
.seal{background:linear-gradient(180deg,var(--accent),var(--accent-dark));color:white;width:92px;height:92px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.4rem;box-shadow:0 12px 46px rgba(208,40,110,0.22);transform:translateZ(48px);font-weight:800;transition:transform 500ms cubic-bezier(.2,.9,.25,1)}
.envelope.open .seal{animation:sealPop 700ms cubic-bezier(.2,.9,.25,1)}
@keyframes sealPop{0%{transform:translateZ(48px) scale(.96)}50%{transform:translateZ(48px) scale(1.08) rotate(-6deg)}100%{transform:translateZ(48px) scale(1) rotate(-8deg)}}
.envelope-flap{
  position:absolute;
  left:0;
  top:0;
  width:100%;
  height:56%;
  background: linear-gradient(180deg, #fff3f7 0%, #ffcfe6 100%);
  transform-origin:top center;
  border-bottom-left-radius:18px;
  border-bottom-right-radius:18px;
  box-shadow: inset 0 -8px 30px rgba(0,0,0,0.05);
  backface-visibility:hidden;
  z-index:30;
  transform:rotateX(0deg);
}

/* LETTER / PAPER */
.letter{
  position:absolute;
  left:6%;
  right:6%;
  bottom:6%;
  height:78%;
  display:flex;
  align-items:stretch;
  justify-content:center;
  transform:translateY(30%);
  z-index:0;
  pointer-events:none;
  opacity:0;
  visibility:hidden;
  transition: all 700ms cubic-bezier(.22,.9,.38,1);
}

/* paper inside envelope: flex column so content area can grow/shrink and scroll */
.paper{
  width:100%;
  height:100%;
  background: linear-gradient(180deg, var(--paper) 0%, #fffdf6 100%);
  border-radius:12px;
  padding:22px 20px 20px;
  border:1px solid rgba(10,10,10,0.04);
  box-shadow:0 22px 48px rgba(25,10,30,0.10);
  position:relative;
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:hidden;
  transform:scale(0.98);
  opacity:0;
  visibility:hidden;
  transition: all 600ms cubic-bezier(.2,.9,.3,1);
}

/* editable / read-only content: flexible, scrollable, and avoids overlap with signature */
.letter-content{
  flex: 1 1 auto;
  min-height: 0;                 /* critical for correct flexbox scrolling */
  width:100%;
  outline:none;
  overflow:auto;                 /* scrolls when content is longer than the area */
  font-size: clamp(1rem, 1.6vw, 1.4rem);
  color:#4b2330;
  line-height:1.6;
  font-family: 'Dancing Script', 'Brush Script MT', 'Segoe UI', 'Segoe Print', cursive;
  white-space:pre-wrap;
  word-break: break-word;
  -webkit-font-smoothing:antialiased;
  padding-right:8px;
  padding-bottom: 64px;          /* reserve space for signature */
  caret-color: var(--accent-dark);

  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
  overscroll-behavior: contain;
  position:relative;
  z-index:1;
}

/* OPEN vs CLOSED visual states */
/* Ensure closed appearance explicitly (prevents accidental 'always open') */
.envelope:not(.open) .envelope-flap {
  transform: rotateX(0deg) !important;
  box-shadow: inset 0 -8px 30px rgba(0,0,0,0.05);
  transition: transform 700ms cubic-bezier(.22,.9,.38,1);
}


/* hide / disable interactions while closed */

/* Active/open state */
.envelope.open .envelope-flap{
  transform:rotateX(-180deg);
  box-shadow:0 6px 14px rgba(0,0,0,0.06);
}
.envelope.open .paper{transform:translateY(-8px) scale(1);box-shadow:0 30px 60px rgba(25,10,30,0.08)}
.envelope.open .seal{transform:translateY(-8px) scale(.96) rotate(-8deg);opacity:0.9}
/* Make letter fully visible and fill envelope */
.envelope.open .letter{
  left:0;
  right:0;
  bottom:0;
  height:100%;
  transform:translateY(0);   /* FIXED */
  opacity:1;
  visibility:visible;
  pointer-events:auto;
  z-index:60;
}

/* small pop animation when letter emerges */
@keyframes pop {
  0%{transform:translateY(6px) scale(.995)}
  60%{transform:translateY(-6px) scale(1.012)}
  100%{transform:translateY(0) scale(1)}
}
.envelope.open .paper{
  transform:scale(1);
  opacity:1;
  visibility:visible;
  box-shadow:0 30px 60px rgba(25,10,30,0.08);
}

/* FLOATING HEARTS (robust/scalable) */
.floating-hearts{
  position:fixed;
  left:0;
  right:0;
  top:0;
  bottom:0;
  pointer-events:none;
  overflow:visible;
  z-index:5;
}

/* heart: supports dynamic width/height set by JS (CSS var or inline) */
.heart{
  --size: 32px;
  position: absolute;
  bottom: -48px;
  width: var(--size);
  height: var(--size);
  background: #ff6b8a;
  transform: rotate(-45deg);
  transform-origin: center center;
  border-radius: 0;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  will-change: transform, opacity;
}

/* lobes: sized relative to the heart element itself (100% of its width/height) */
.heart::before,
.heart::after {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  background: inherit;
  border-radius: 50%;
  pointer-events: none;
}

/* left lobe: centered above the left half of the square */
.heart::before {
  left: 0;
  top: -50%;
}

/* right lobe: centered above the right half of the square */
.heart::after {
  left: 50%;
  top: -50%;
}

/* optional slight growth for large hearts so lobes still overlap well */
.heart.large::before,
.heart.large::after {
  width: 105%;
  height: 105%;
  left: -2.5%;
  top: -52.5%;
}

/* float animation */
@keyframes floatUp{
  0%{ transform: translateY(0) rotate(-45deg); opacity:0 }
  8%{ opacity:1 }
  100%{ transform: translateY(-110vh) rotate(12deg); opacity:0 }
}
.heart.rose { background: #ff8aa6; }

/* sparkles shown briefly when envelope opens */
.sparkle{position:absolute;border-radius:50%;background:radial-gradient(circle,#fff8fb,#ffd7ea);box-shadow:0 8px 20px rgba(255,140,170,0.12);opacity:0;transform:translateY(0) scale(.6);animation:sparkleUp 900ms forwards}
@keyframes sparkleUp{0%{opacity:1;transform:translateY(0) scale(0.6)}100%{opacity:0;transform:translateY(-120px) scale(1.4)}}

/* signature sits visually over the paper but does not block typing thanks to padding-bottom */
.signature{
  position:absolute;
  right:18px;
  bottom:12px;
  color:var(--accent-dark);
  font-weight:700;
  font-family: 'Segoe UI', system-ui, sans-serif;
  z-index:6;
  pointer-events:none;
}

/* scrollbar visuals */
.letter-content {
  scrollbar-width: thin;
  scrollbar-color: rgba(180,90,110,0.55) transparent;
}
.letter-content::-webkit-scrollbar { width: 8px; height: 8px; }
.letter-content::-webkit-scrollbar-thumb {
  background: rgba(180,90,110,0.55);
  border-radius: 8px;
}

.letter-content.is-empty{
  min-height:120px;
}
.letter-content.is-empty:before{content:attr(data-placeholder);display:block;color:#d48a98;opacity:0.9;font-style:italic}

/* controls and buttons */
.controls{display:flex;gap:10px;align-items:center;justify-content:center}
.btn{background:linear-gradient(180deg,#ff8aa6,#ff5c8a);color:white;padding:12px 20px;border-radius:999px;border:0;box-shadow:0 10px 30px rgba(255,92,138,0.22);cursor:pointer;font-weight:700;font-size:1rem}
.btn.alt{background:transparent;color:var(--accent-dark);border:2px solid rgba(208,90,120,0.14)}
.btn:active{transform:translateY(1px) scale(.999)}
.note{text-align:center;margin-top:10px;color:var(--muted)}

/* responsive */
@media (max-width:480px){
  .envelope{height:200px}
  .seal{width:56px;height:56px}
  .paper{padding:14px}
  .hero h1{font-size:1.6rem}
  .letter-content{font-size: clamp(0.95rem, 2.8vw, 1.1rem); padding-bottom:56px}
  .letter-content.is-empty{min-height:100px}
  .signature{right:12px;bottom:10px}
}